<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ✅ 인터페이스 FQN과 정확히 일치 -->
<mapper namespace="com.gym.mapper.xml.MemberQueryMapper">

	<!-- 공통 맵핑 -->
	<resultMap id="MemberMap" type="com.gym.domain.member.Member">
		<id column="member_id" property="memberId" />
		<result column="member_pw" property="memberPw" />
		<result column="member_name" property="memberName" />
		<result column="member_gender" property="memberGender" />
		<result column="member_email" property="memberEmail" />
		<result column="member_mobile" property="memberMobile" />
		<result column="member_phone" property="memberPhone" />
		<result column="zip" property="zip" />
		<result column="road_address" property="roadAddress" />
		<result column="jibun_address" property="jibunAddress" />
		<result column="detail_address" property="detailAddress" />
		<result column="member_birthday" property="memberBirthday" />
		<result column="member_manipay" property="memberManipay" />
		<result column="member_joindate" property="memberJoindate" />
		<result column="member_role" property="memberRole" />
		<result column="admin_type" property="adminType" />
	</resultMap>

	<!-- [250926 수정] 회원 등록 -->
	<!-- <insert id="insertMember"
		parameterType="com.gym.domain.member.Member">
		INSERT INTO member_tbl (
		member_id,
		member_pw,
		member_name,
		member_gender,
		member_email,
		member_mobile,
		member_phone,
		zip,
		road_address,
		jibun_address,
		detail_address,
		member_birthday,
		member_manipay,
		member_role,
		admin_type
		) VALUES (
		#{memberId, jdbcType=VARCHAR},
		#{memberPw, jdbcType=VARCHAR},
		#{memberName, jdbcType=VARCHAR},
		#{memberGender, jdbcType=CHAR},
		#{memberEmail, jdbcType=VARCHAR},
		#{memberMobile, jdbcType=VARCHAR},
		#{memberPhone, jdbcType=VARCHAR},
		#{zip, jdbcType=VARCHAR},
		#{roadAddress, jdbcType=VARCHAR},
		#{jibunAddress, jdbcType=VARCHAR},
		#{detailAddress, jdbcType=VARCHAR},
		#{memberBirthday, jdbcType=DATE},
		#{memberManipay, jdbcType=NUMERIC},   ✅ NUMBER → NUMERIC
		#{memberManipay, jdbcType=VARCHAR}
		#{memberRole, jdbcType=VARCHAR},
		#{adminType, jdbcType=VARCHAR}
		)
	</insert> -->
	
	<insert id="insertMember" parameterType="com.gym.domain.member.Member">
	  INSERT INTO member_tbl (
	    member_id,
	    member_pw,
	    member_name,
	    member_gender,
	    member_email,
	    member_mobile,
	    member_phone,
	    zip,
	    road_address,
	    jibun_address,
	    detail_address,
	    member_birthday,
	    member_manipay,
	    member_role,
	    admin_type
	  )
	  VALUES (
	    #{memberId, jdbcType=VARCHAR},
	    #{memberPw, jdbcType=VARCHAR},
	    #{memberName, jdbcType=VARCHAR},
	    #{memberGender, jdbcType=CHAR},
	    #{memberEmail, jdbcType=VARCHAR},
	    #{memberMobile, jdbcType=VARCHAR},
	    #{memberPhone, jdbcType=VARCHAR},
	    #{zip, jdbcType=VARCHAR},             <!-- ✅ null이면 VARCHAR 타입 null -->
	    #{roadAddress, jdbcType=VARCHAR},     <!-- ✅ 필수 -->
	    #{jibunAddress, jdbcType=VARCHAR},    <!-- ✅ 필수 -->
	    #{detailAddress, jdbcType=VARCHAR},   <!-- ✅ 필수 -->
	    #{memberBirthday, jdbcType=DATE},     <!-- ✅ 날짜 null 가능 -->
	    #{memberManipay, jdbcType=VARCHAR},   <!-- or NUMERIC -->
	    #{memberRole, jdbcType=VARCHAR},
	    #{adminType, jdbcType=VARCHAR}
	  )
	</insert>
	


	<!-- [250926 수정] 회원 단건 조회 -->
	<select id="selectMemberById" resultMap="MemberMap"
		parameterType="string">
		SELECT
		member_id, member_pw, member_name, member_gender, member_email,
		member_mobile, member_phone, zip, road_address, jibun_address,
		detail_address, member_birthday, member_manipay, member_joindate,
		member_role, admin_type
		FROM member_tbl
		WHERE member_id = #{value}   <!-- 반드시 
			#{value} -->
	</select>



	<!-- [250926 수정] 회원 수정 -->
	<update id="updateMember"
		parameterType="com.gym.domain.member.Member">
		UPDATE member_tbl
		<set>
			<if test="memberPw != null">member_pw = #{memberPw},</if>
			<if test="memberEmail != null">member_email = #{memberEmail},</if>
			<if test="memberMobile != null">member_mobile = #{memberMobile},</if>
			<if test="memberPhone != null">member_phone = #{memberPhone, jdbcType=VARCHAR},</if>
			<if test="zip != null">zip = #{zip},</if> <!-- [251005] zip추가 -->
			<if test="roadAddress != null">road_address = #{roadAddress},</if>
			<if test="detailAddress != null">detail_address = #{detailAddress},</if>
		</set>
		<!-- WHERE member_id = #{memberId}-->
		WHERE member_id = #{memberId, jdbcType=VARCHAR}
		
	</update>

	<!-- [250926 수정] 회원 목록 조회 -->
	<select id="selectMembers"
		resultType="com.gym.domain.member.Member">
		SELECT
		member_id AS memberId,
		member_pw AS memberPw,
		member_name AS
		memberName,
		member_gender AS memberGender,
		member_email AS memberEmail,
		member_mobile AS memberMobile,
		member_phone AS memberPhone,
		zip AS zip,
		road_address AS roadAddress,
		jibun_address AS jibunAddress,
		detail_address AS detailAddress,
		member_birthday AS memberBirthday,
		member_manipay AS memberManipay,
		member_joindate AS memberJoindate,
		member_role AS memberRole,
		admin_type AS adminType
		FROM member_tbl
		<where>
			<if test="keyword != null and keyword != ''">
				(member_id LIKE '%' || #{keyword} || '%'
				OR member_name
				LIKE '%' || #{keyword} || '%'
				OR member_email LIKE '%' || #{keyword}
				|| '%')
			</if>
			<if test="role != null and role != ''">
				AND member_role = #{role}
			</if>
		</where>
		<if test="page != null and size != null">
			OFFSET #{(page-1)*size} ROWS FETCH NEXT #{size} ROWS ONLY
		</if>
	</select>

	<!-- [250926 수정] 총 회원 수 -->
	<select id="countMembers" resultType="long">
		SELECT COUNT(*)
		FROM member_tbl
		<where>
			<if test="keyword != null and keyword != ''">
				(member_id LIKE '%' || #{keyword} || '%'
				OR member_name
				LIKE '%' || #{keyword} || '%'
				OR member_email LIKE '%' || #{keyword}
				|| '%')
			</if>
			<if test="role != null and role != ''">
				AND member_role = #{role}
			</if>
		</where>
	</select>

	<!-- [251008 추가] CMS 강사 조회용 -->
	<select id="selectCmsMembers" resultMap="MemberMap">
		SELECT member_id, member_name, admin_type
		FROM member_tbl
		WHERE 1=1
		<if test="adminType != null and adminType != ''">
			AND admin_type = #{adminType}
		</if>
		<if test="name != null and name != ''">
			AND member_name LIKE '%' || #{name} || '%'
		</if>
		ORDER BY member_id DESC
	</select>
	
</mapper>